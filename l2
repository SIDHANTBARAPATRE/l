# lab2
import kagglehub
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import os

path = kagglehub.dataset_download("julianbloise/winners-formula-1-1950-to-2025")

dataset_file = os.path.join(path, 'winners_f1_1950_2025_v2.csv')
df = pd.read_csv(dataset_file)
print(f"Data Loaded Successfully. Shape: {df.shape}")

numeric_cols = df.select_dtypes(include=[np.number]).columns
categorical_cols = df.select_dtypes(include=['object', 'category']).columns

print(f"\nNumeric Columns: {numeric_cols.tolist()}")
print(f"Categorical Columns: {categorical_cols.tolist()}")

if not numeric_cols.empty:
    desc = pd.DataFrame(index=numeric_cols)
    desc['Mean'] = df[numeric_cols].mean()
    desc['Median'] = df[numeric_cols].median()
    desc['Mode'] = df[numeric_cols].mode().iloc[0]
    print(desc)
else:
    print("No numeric columns available for statistics.")

for col in categorical_cols:
    print(f"\nAnalyzing Feature: {col}")

    counts = df[col].value_counts()

    if len(counts) > 1:
        majority_count = counts.iloc[0]
        minority_count = counts.iloc[-1]

        imbalance_ratio = majority_count / minority_count

        print(f"   Top Group:    {counts.index[0]} ({majority_count})")
        print(f"   Bottom Group: {counts.index[-1]} ({minority_count})")
        print(f"   Imbalance Ratio: {imbalance_ratio:.2f}")

        if imbalance_ratio > 10:
            print("   ⚠️ STATUS: CRITICAL IMBALANCE")
        elif imbalance_ratio > 3:
            print("   ⚠️ STATUS: MODERATE IMBALANCE")
        else:
            print("   ✅ STATUS: BALANCED")

    else:
        print("   -> Constant value (Skipped)")

plot_cols = categorical_cols[:3]

for col in plot_cols:
    plt.figure(figsize=(10, 5))

    top_n = df[col].value_counts().nlargest(10)

    sns.barplot(x=top_n.index, y=top_n.values)
    plt.title(f'Distribution: {col} (Top 10)')
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.show()
